<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Audit Dashboard</title>
    <link rel="stylesheet" href="assets/bootstrap.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .stat-card { border-radius: 10px; border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .file-list { font-family: 'Courier New', Courier, monospace; font-size: 0.85rem; background: #eee; padding: 10px; border-radius: 5px; }
        .set-header { cursor: pointer; transition: background 0.2s; }
        .set-header:hover { background-color: #f1f1f1 !important; }
    </style>
</head>
<body>

<div class="container py-4">
    <header class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">System File Audit</h1>
        <input type="file" id="fileInput" class="form-control w-auto" accept=".json">
    </header>

    <div id="content" style="display:none;">
        <div class="row g-3 mb-4">
            <div class="col-md-3"><div class="card stat-card p-3"><h6>Savings</h6><h4 id="stat-savings" class="text-success">-</h4></div></div>
            <div class="col-md-3"><div class="card stat-card p-3"><h6>Duplicate Sets</h6><h4 id="stat-sets">-</h4></div></div>
            <div class="col-md-3"><div class="card stat-card p-3"><h6>Total Files</h6><h4 id="stat-files">-</h4></div></div>
            <div class="col-md-3"><div class="card stat-card p-3"><h6>Scan Time</h6><h4 id="stat-time">-</h4></div></div>
        </div>

        <ul class="nav nav-tabs mb-3" id="auditTabs">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-dupes">Duplicates</button></li>
            <li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#tab-errors">Skipped Items</button></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="tab-dupes">
                <div id="dupe-list"></div>
            </div>

            <div class="tab-pane fade" id="tab-errors">
                <div class="table-responsive">
                    <table class="table table-hover table-sm">
                        <thead class="table-light"><tr><th>Path</th><th>Reason</th></tr></thead>
                        <tbody id="error-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="assets/bootstrap.bundle.min.js"></script>

<script>
    // [The JavaScript logic to handle the JSON remains similar, 
    // but now injects data into 'error-list' as well as 'dupe-list']
    
    document.getElementById('fileInput').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const data = JSON.parse(event.target.result);
            render(data);
        };
        reader.readAsText(e.target.files[0]);
    });

    function render(data) {
        document.getElementById('content').style.display = 'block';
        
        // Render Stats
        document.getElementById('stat-savings').innerText = (data.summary.potentialSavingsBytes / 1024 / 1024 / 1024).toFixed(2) + " GB";
        document.getElementById('stat-sets').innerText = data.summary.duplicateSets;
        document.getElementById('stat-files').innerText = data.summary.totalFilesScanned;
        document.getElementById('stat-time').innerText = data.metadata.durationSeconds + "s";

        // Render Duplicates
        const dupeContainer = document.getElementById('dupe-list');
        dupeContainer.innerHTML = data.sets.map((set, i) => `
            <div class="card mb-2">
                <div class="card-header set-header d-flex justify-content-between" data-bs-toggle="collapse" data-bs-target="#set-${i}">
                    <span><strong>${set.files[0].name}</strong> (${(set.size/1024).toFixed(1)} KB)</span>
                    <span class="badge bg-primary rounded-pill">${set.fileCount} copies</span>
                </div>
                <div class="collapse" id="set-${i}">
                    <div class="card-body bg-light"><div class="file-list">${set.files.map(f => `<div>${f.path}</div>`).join('')}</div></div>
                </div>
            </div>
        `).join('');

        // Render Errors
        const errorContainer = document.getElementById('error-list');
        errorContainer.innerHTML = data.errors.map(err => `
            <tr><td class="small text-break">${err.path}</td><td><span class="badge bg-danger">${err.reason}</span></td></tr>
        `).join('');
    }
</script>
</body>
</html>